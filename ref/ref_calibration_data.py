import numpy as np

# =============================================================================
# v4 Calibration (X 양수가 전방) - synchronized_data_indoor_optimized용
# =============================================================================
DEFAULT_CALIB_v4 = {
    "a6": {
        "model": "vadas",
        "intrinsic": [
            -0.0004, 1.0136, -0.0623, 0.2852, -0.332, 0.1896, -0.0391,  # u2d (k[0:7])
            1.05007, 0.0021, -0.00152588, 0.000793457,  # s, div, ux, uy
            0, 0.9965, -0.0067, -0.0956, 0.1006, -0.054, 0.0106  # d2u
        ],
        "extrinsic": [0.00660233, 0.0122275, -0.230106, -0.0429939, 0.0809541, 0.01427919],
        "image_size": (1920, 1536)
    }
}

# =============================================================================
# v3 Calibration (X 양수가 전방) - synchronized_data_pangyo_optimized용
# =============================================================================
DEFAULT_CALIB = {
  "a6": {
    "model": "vadas",
    "intrinsic": [-0.0004, 1.0136, -0.0623, 0.2852, -0.332, 0.1896, -0.0391, #u2d
                  1.0447, 0.0021, 44.9516, 2.48822, # focal, pixel_size, cx, cy
                  0, 0.9965, -0.0067, -0.0956, 0.1006, -0.054, 0.0106], #d2u
    "extrinsic": [ 0.119933, -0.129544, -0.54216, -0.0333289, -0.166123, -0.0830659],  # v3
    "image_size": (1920, 1536)  # [FIX] 명시적으로 원본 이미지 크기 설정
  }
}

# =============================================================================
# v2 Calibration (X 음수가 전방) - ncdb-cls 데이터용
# =============================================================================
DEFAULT_CALIB_v2 = {
  "a6": {
    "model": "vadas",
    "intrinsic": [-0.0004, 1.0136, -0.0623, 0.2852, -0.332, 0.1896, -0.0391, #u2d
                  1.0447, 0.0021, 44.9516, 2.48822, # focal, pixel_size, cx, cy
                  0, 0.9965, -0.0067, -0.0956, 0.1006, -0.054, 0.0106], #d2u
    "extrinsic": [ 0.293769, -0.0542026, -0.631615, -0.00394431, -0.33116, -0.00963617 ],  # v2
    "image_size": (1920, 1536)
  }
}

# =============================================================================
# v2 LiDAR → World 변환 행렬 (X 음수가 전방)
# =============================================================================
DEFAULT_LIDAR_TO_WORLD_v2 = np.array([
    [-0.998752, -0.00237052, -0.0498847,  0.0375091],
    [ 0.00167658, -0.999901,   0.0139481,  0.0349093],
    [-0.0499128,  0.0138471,   0.998658,   0.771878],
    [ 0.,         0.,          0.,         1.       ]
])

# =============================================================================
# 새로운 버전 (X 양수가 전방) - 2025.11.25 업데이트
# =============================================================================
# LiDAR → World 변환 행렬 (새로운 좌표계: X 양수가 전방)
DEFAULT_LIDAR_TO_WORLD_v3 = np.array([
    [0.993292,    -0.10137,   -0.055641,    0.03384],
    [0.10098,      0.99484,  -0.00977845, -0.00561394],
    [0.0563451,  0.00409421,   0.998403,    0.749149],
    [0.,           0.,          0.,          1.]
])

# 검증된 LiDAR → Camera 변환 행렬
# 계산: Extrinsic @ LIDAR_TO_WORLD_v3
# Extrinsic: [0.119933, -0.129544, -0.54216, -0.0333289, -0.166123, -0.0830659]
DEFAULT_LIDAR_TO_CAM_v3 = np.array([
    [0.9756,   -0.0154035, -0.219016,  0.0300323],
    [0.0235529, 0.999122,   0.0346482, -0.107863],
    [0.21829,  -0.0389613,  0.975106,   0.20205],
    [0.,        0.,         0.,         1.]
])


# v4용 LiDAR → World 변환 행렬
# LiDAR = World 가정 (Identity)
DEFAULT_LIDAR_TO_WORLD_v4 = np.array([
       [0.999823, -0.0183399, -0.00420554, -0.0510422],
       [0.0182813, 0.999741, -0.0135742, -0.0243783],
       [0.0044534, 0.013495, 0.999899, 0.341502],
       [0, 0, 0, 1]
])

# v4 LiDAR → Camera 변환 행렬
# v4 extrinsic만 사용: LiDAR → Camera = World → Camera (LiDAR=World 가정)
# extrinsic: [0.00660233, 0.0122275, -0.230106, -0.0429939, 0.0809541, 0.01427919]
DEFAULT_LIDAR_TO_CAM_v4 = np.array([
       [0.996513, -0.0331847, 0.076549, -0.0163759],
       [0.0309737, 0.999073, 0.0298925, 0.00209386],
       [-0.07747, -0.0274172, 0.996618, 0.115137],
       [0, 0, 0, 1]
])


# =============================================================================
# 이전 LiDAR → Camera 행렬 (주석 처리)
# =============================================================================
# get_lidar_to_cam_matrix.py에서 계산된 T_lidar_to_cam 행렬 (extrinsic_v2 기준)
# DEFAULT_LIDAR_TO_CAM = np.array([
#     [ 0.9456203,   0.01010798, -0.32511547,  0.293769   ],
#     [-0.00881369,  0.99994629,  0.00545355, -0.0542026  ],
#     [ 0.32515313, -0.00229153,  0.9456586,  -0.631615   ],
#     [ 0.,          0.,          0.,          1.         ]
# ])

# DEFAULT_LIDAR_TO_CAM_v3_OLD = np.array([
#   [ 0.98280272,  0.08533396, -0.16375873,  0.119933  ],
#   [-0.07981367,  0.99600649,  0.04001059, -0.129544  ],
#   [ 0.16651902, -0.02625233,  0.98568871, -0.54216   ],
#   [ 0.,          0.,          0.,          1.        ]
# ])